<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Malla Curricular – Ingeniería Eléctrica Univalle</title>

<style>
body{
  font-family: Arial, Helvetica, sans-serif;
  background:#f2f5f7;
  margin:0;
  padding:20px;
}

h1{
  text-align:center;
  color:#263238;
}

#progress{
  max-width:500px;
  margin:15px auto;
  text-align:center;
}

#bar{
  height:16px;
  background:#cfd8dc;
  border-radius:10px;
  overflow:hidden;
}

#fill{
  height:100%;
  width:0;
  background:#4db6ac;
  transition:.3s;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:12px;
}

.sem{
  background:white;
  border-radius:10px;
  padding:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}

.sem h3{
  text-align:center;
  margin:5px 0 10px;
  color:#0277bd;
  font-size:14px;
}

.card{
  border:1px solid #b0bec5;
  border-radius:6px;
  padding:6px;
  margin-bottom:6px;
  font-size:12px;
  cursor:pointer;
  background:#fffde7;
}

.card.approved{
  background:#c8e6c9;
}

.card.locked{
  background:#eceff1;
  cursor:not-allowed;
  opacity:.7;
}

.card.locked:hover::after{
  content:attr(data-tip);
  position:absolute;
  background:#263238;
  color:#fff;
  padding:4px 6px;
  font-size:11px;
  border-radius:5px;
  margin-left:5px;
}

.code{font-weight:bold}
.cr{float:right;color:#546e7a}
</style>
</head>

<body>

<h1>Malla Curricular – Ingeniería Eléctrica (Univalle)</h1>

<div id="progress">
  <div id="text"></div>
  <div id="bar"><div id="fill"></div></div>
</div>

<div class="grid" id="malla"></div>

<script>
const materias=[
{ id:'MATB', n:'Matemáticas Básicas', c:3, s:1, r:[] },
{ id:'CAL1', n:'Cálculo Monovariable', c:3, s:2, r:['MATB'] },
{ id:'CAL2', n:'Cálculo Multivariable', c:3, s:3, r:['CAL1'] },
{ id:'EDO',  n:'Ecuaciones Diferenciales', c:3, s:3, r:['CAL2'] },
{ id:'CIR1', n:'Circuitos I', c:4, s:4, r:['CAL1'] },
{ id:'CIR2', n:'Circuitos II', c:4, s:5, r:['CIR1'] },
{ id:'ELE1', n:'Electrónica I', c:2, s:4, r:['CIR1'] },
{ id:'ELE2', n:'Electrónica II', c:3, s:6, r:['ELE1'] },
{ id:'MAQ1', n:'Máquinas I', c:3, s:7, r:['CIR2'] },
{ id:'MAQ2', n:'Máquinas II', c:3, s:8, r:['MAQ1'] },
{ id:'TG1',  n:'Trabajo de Grado I', c:4, s:9, r:['MAQ2'] },
{ id:'TG2',  n:'Trabajo de Grado II', c:4, s:10, r:['TG1'] }
];

const estado=JSON.parse(localStorage.getItem('ie_estado')||'{}');
const malla=document.getElementById('malla');

function render(){
  malla.innerHTML='';
  let total=0, ok=0;

  materias.forEach(m=>total+=m.c);
  materias.forEach(m=>{ if(estado[m.id]) ok+=m.c; });

  let pct=Math.round(ok/total*100);
  document.getElementById('fill').style.width=pct+'%';
  document.getElementById('text').innerText=
    `Créditos aprobados: ${ok} / ${total} (${pct}%)`;

  for(let s=1;s<=10;s++){
    let col=document.createElement('div');
    col.className='sem';
    col.innerHTML=`<h3>Semestre ${s}</h3>`;

    materias.filter(m=>m.s===s).forEach(m=>{
      let card=document.createElement('div');
      card.className='card';
      card.innerHTML=`<span class="code">${m.n}</span><span class="cr">${m.c}</span>`;

      let faltan=m.r.filter(x=>!estado[x]);
      if(faltan.length){
        card.classList.add('locked');
        card.dataset.tip='Requiere: '+faltan.join(', ');
      }
      if(estado[m.id]) card.classList.add('approved');

      card.onclick=()=>{
        if(card.classList.contains('locked')) return;
        estado[m.id]=!estado[m.id];
        localStorage.setItem('ie_estado',JSON.stringify(estado));
        render();
      };

      col.appendChild(card);
    });

    if(col.children.length>1) malla.appendChild(col);
  }
}

render();
</script>

</body>
</html>
